<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Title</title>
  </head>
  <body>
    <!--  COPY THE CODE FROM HERE INTO SQUARESPACE-->
    <div class="form-wrapper">
      <form id="membership_form" method="post">
        <div id="infoTab" class="field-list">
          <div class="field">
            <label for="first_name">First Name *</label>
            <label class="caption">
              <input
                id="first_name"
                name="first_name"
                type="text"
                class="field-element"
                required
            /></label>
          </div>
          <div class="field">
            <label for="last_name">Last Name *</label>
            <label class="caption">
              <input
                id="last_name"
                name="last_name"
                type="text"
                class="field-element"
                required
            /></label>
          </div>
          <div class="field">
            <label for="school">School</label>
            <label class="caption">
              <input
                id="school"
                name="school"
                class="field-element"
                type="text"
            /></label>
          </div>
          <div class="field">
            <label for="program">
              Program & College (if you are a UofT student)
            </label>
            <label class="caption">
              <input
                id="program"
                type="text"
                class="field-element"
                name="program_and_college"
              />
            </label>
          </div>
          <div class="field">
            <label for="email"
              >Email * (we will notify you of events and trips using this
              email)</label
            >
            <label class="caption">
              <input
                id="email"
                type="email"
                class="field-element"
                name="email"
                required
            /></label>
          </div>
          <div class="field">
            <label for="found_utoc">How did you find UTOC? </label>
            <label class="caption">
              <input
                id="found_utoc"
                name="found_utoc"
                class="field-element"
                type="text"
            /></label>
          </div>
          <fieldset class="field radio">
            <label>Are you interested in family style events? *</label>

            <div class="option">
              <label for="yes">
                <input
                  type="radio"
                  id="yes"
                  value="yes"
                  name="interested_in_family_events"
                  required
                />
                Yes
              </label>
            </div>
            <div class="option">
              <input
                type="radio"
                id="no"
                value="no"
                name="interested_in_family_events"
                required
              />

              <label for="no">No</label><br />
            </div>
          </fieldset>

          <div class="field select">
            <label for="membership_type" class="title"
              >Choose your membership type:</label
            >

            <select name="membership_type" id="membership_type">
              <option value="student">Student Membership $20.00 CAD</option>
              <option value="regular">Regular Membership $30.00 CAD</option>
              <option value="family">Family Membership $40.00 CAD</option>
              <option value="summer">Summer Membership $10.00 CAD</option>
            </select>
          </div>

          <br />

          <button
            type="button"
            class="sqs-editable-button"
            onclick="toPayment()"
          >
            Next
          </button>
        </div>

        <div id="paymentTab" style="display: none;">
          <h2>Payment</h2>

          <input type="hidden" id="orderID" name="orderID" />

          <div id="paypal-button-container"></div>
        </div>
      </form>
    </div>

    <script
      src="https://www.paypal.com/sdk/js?client-id=AVhTs5Ui8fjSnR5-CH-IZ2_NQvgyFYZHUEW-tYaBZKQS61gnrpc9rjc_4bVldcQklV1WPtswTRG_B-Hc&currency=CAD"
      data-sdk-integration-source="button-factory"
    ></script>

    <script>
      const isDevelopment = true;

      const PRICING = {
        student: 20,
        regular: 30,
        family: 40,
        summer: 10,
      };

      const membershipForm = document.getElementById("membership_form");

      if (isDevelopment) membershipForm.action = "http://localhost:8080";
      else
        membershipForm.action =
          "https://northamerica-northeast1-utoc-payment.cloudfunctions.net/on-membership-payment";

      function toPayment() {
        if (!membershipForm.checkValidity()) return;
        // Hide the current tab:
        document.getElementById("infoTab").style.display = "none";
        // Display the next tab
        document.getElementById("paymentTab").style.display = "inline";
      }

      paypal
        .Buttons({
          style: {
            shape: "rect",
            color: "blue",
            layout: "vertical",
            label: "paypal",
          },
          createOrder: function (data, actions) {
            const typeDropdown = document.getElementById("membership_type");
            const value = PRICING[
              typeDropdown.options[typeDropdown.selectedIndex].value
            ].toString();
            return actions.order.create({
              purchase_units: [{ amount: { value } }],
            });
          },
          onApprove: function (data) {
            document.getElementById("orderID").value = data.orderID;
            membershipForm.submit();
          },
        })
        .render("#paypal-button-container");
    </script>
    <!-- COPY THE CODE UNTIL HERE INTO SQUARESPACE -->
  </body>
</html>
